
Sub AdvancedFilterCopy2()     ' إجراء التصفية المتقدمة الى A2ورقة
    Application.ScreenUpdating = False
    Dim wsSource As Worksheet, wsDest As Worksheet
    Dim lastRow As Long, lastCritRow As Long
    Dim rngSource As Range, rngCriteria As Range, rngDest As Range
    Dim cell As Range
    Dim destLastRow As Long

    ' تعيين مراجع الأوراق
    Set wsSource = ThisWorkbook.Sheets("ALL FA- الاصول")
    Set wsDest = ThisWorkbook.Sheets("A2")

    ' مسح البيانات القديمة والألوان في ورقة الوجهة من الصف الأول
    With wsDest.Cells(1, 1).Resize(wsDest.Rows.Count, wsDest.Columns.Count)
        .ClearContents
        .Interior.ColorIndex = xlNone
    End With

    ' تحديد الصف الأخير في النطاق المصدر
    lastRow = wsSource.Cells(wsSource.Rows.Count, "A").End(xlUp).row
    Set rngSource = wsSource.Range("A1:AY" & lastRow)

    ' تحديد الصف الأخير في نطاق المعايير
    lastCritRow = wsSource.Cells(wsSource.Rows.Count, "BC").End(xlUp).row
    If lastCritRow < 1 Then lastCritRow = 1 ' تأكد من وجود صف واحد على الأقل للمعايير
    Set rngCriteria = wsSource.Range("BC2:BC" & lastCritRow) ' بدءاً من الصف الثاني لتجنب عنوان العمود

    ' تعيين نطاق الوجهة
    Set rngDest = wsDest.Range("A1")

    ' إجراء التصفية المتقدمة
    rngSource.AdvancedFilter Action:=xlFilterCopy, criteriaRange:=wsSource.Range("BC1:BC" & lastCritRow), CopyToRange:=rngDest, Unique:=False

    ' تحديد آخر صف يحتوي على بيانات في ورقة الوجهة
    destLastRow = wsDest.Cells(wsDest.Rows.Count, "A").End(xlUp).row

    ' نسخ القيم من العمود BC إلى ورقة الوجهة في العمود A بعد آخر صف يحتوي على بيانات
    wsSource.Range("BC1:BC" & lastCritRow).Copy Destination:=wsDest.Range("A" & (destLastRow + 2))

    ' تلوين القيم غير المتكررة في العمود A بعد آخر صف يحتوي على بيانات
    Dim checkRange As Range
    Set checkRange = wsDest.Range("A1:A" & destLastRow)

    For Each cell In wsDest.Range("A" & (destLastRow + 3) & ":A" & (destLastRow + 2 + lastCritRow))
        If Application.WorksheetFunction.CountIf(checkRange, cell.Value) = 0 Then
            cell.Interior.color = RGB(255, 242, 204) ' لون ذهبي التمييز
        End If
    Next cell

    Application.ScreenUpdating = True
    MsgBox "تم تنفيذ التصفية والنسخ بنجاح. تم تلوين القيم غير المتكررة.", vbInformation
End Sub







Sub AdvancedFilter()        '  التصفية المتقدمة في نفس الموقع
    Dim ws As Worksheet
    Dim filterRange As Range
    Dim criteriaRange As Range
    Dim lastRow As Long

    ' تعيين الورقة الحالية
    Set ws = ThisWorkbook.Sheets("ALL FA- الاصول")

    ' تحديد نطاق البيانات التي سيتم تصفيتها
    Set filterRange = ws.Range("A:AX")

    ' تحديد آخر صف في العمود BD يحتوي على بيانات
    lastRow = ws.Cells(ws.Rows.Count, "BD").End(xlUp).row

    ' تحديد نطاق المعايير
    Set criteriaRange = ws.Range("BD1:BD" & lastRow)

    ' تطبيق التصفية المتقدمة في نفس الموقع
    filterRange.AdvancedFilter Action:=xlFilterInPlace, _
        criteriaRange:=criteriaRange, _
        Unique:=False

    ' إظهار رسالة تأكيد
    MsgBox "تم تطبيق التصفية المتقدمة بنجاح!", vbInformation
End Sub