
Sub FilterAndCopyData() ' "صفحة الواجهة "كود البحث وجلب البيانات
  

    Dim wsSource As Worksheet, wsDest As Worksheet
    Dim lastRow As Long, destRow As Long, dataRow As Long
    Dim filterCriteria As String, filterColumn As Integer
    Dim criteriaValue As String

    Set wsSource = ThisWorkbook.Sheets("ALL FA- الاصول")
    Set wsDest = ThisWorkbook.Sheets("الواجهة")
    destRow = 7  ' بدء العرض من الصف 7

    ' مسح البيانات السابقة في الواجهة
    wsDest.Rows(destRow & ":" & wsDest.Rows.Count).ClearContents
    wsDest.Rows(destRow & ":" & wsDest.Rows.Count).ClearFormats

    ' الحصول على قيمة المعيار من الخلية G3
    criteriaValue = wsDest.Range("G3").Value

    ' تحديد العمود للتصفية وهو العمود H (رقم 8)
    filterColumn = 8

    ' تطبيق التصفية ونقل البيانات
    With wsSource
        lastRow = .Cells(.Rows.Count, filterColumn).End(xlUp).row
        .AutoFilterMode = False
        .Range("A1:Z" & lastRow).AutoFilter Field:=filterColumn, Criteria1:=criteriaValue
        If .AutoFilter.Range.Columns(1).SpecialCells(xlCellTypeVisible).Count > 1 Then
            .AutoFilter.Range.Offset(1, 0).Copy Destination:=wsDest.Cells(destRow, 1)
            dataRow = wsDest.Cells(wsDest.Rows.Count, 1).End(xlUp).row
            ' تطبيق التنسيق العام
            wsDest.Range(wsDest.Cells(destRow, 1), wsDest.Cells(dataRow, "BA")).Borders.Weight = xlThin
            ' تطبيق التنسيق الخاص بالأعمدة المحددة
            Dim cols As Variant
            cols = Array("AT", "AU", "AV", "AW")
            Dim col As Variant
            For Each col In cols
                With wsDest.Range(col & destRow & ":" & col & dataRow)
                    .Interior.color = RGB(255, 242, 204)  ' لون ذهبي التمييز 4، 80% أفتح
                    .Borders.Weight = xlMedium            ' حدود سميكة متوسطة
                End With
            Next col
        Else
            MsgBox "لا توجد بيانات تطابق المعايير."
        End If
        .AutoFilterMode = False
        If .FilterMode Then
            .ShowAllData
        End If
    End With

    MsgBox "تم جلب البيانات بنجاح."
End Sub









Sub FilterAndCopyData2()
    ' كود البحث وجلب البيانات

    Dim wsSource As Worksheet, wsDest As Worksheet
    Dim lastRow As Long, destRow As Long, dataRow As Long
    Dim filterCriteria As String, filterColumn As Integer
    Dim criteriaValue As String

    Set wsSource = ThisWorkbook.Sheets("ALL FA- الاصول")
    Set wsDest = ThisWorkbook.Sheets("الواجهة")
    destRow = 7  ' بدء العرض من الصف 7

    ' مسح البيانات السابقة في الواجهة
    wsDest.Rows(destRow & ":" & wsDest.Rows.Count).ClearContents
    wsDest.Rows(destRow & ":" & wsDest.Rows.Count).ClearFormats

    ' الحصول على قيمة المعيار من الخلية H3
    criteriaValue = wsDest.Range("H3").Value

    ' تحديد العمود للتصفية وهو العمود AT (رقم 46)
    filterColumn = 46

    ' تطبيق التصفية ونقل البيانات
    With wsSource
        lastRow = .Cells(.Rows.Count, filterColumn).End(xlUp).row
        .AutoFilterMode = False
        .Range("A1:Z" & lastRow).AutoFilter Field:=filterColumn, Criteria1:=criteriaValue
        If .AutoFilter.Range.Columns(1).SpecialCells(xlCellTypeVisible).Count > 1 Then
            .AutoFilter.Range.Offset(1, 0).Copy Destination:=wsDest.Cells(destRow, 1)
            dataRow = wsDest.Cells(wsDest.Rows.Count, 1).End(xlUp).row
            ' تطبيق التنسيق العام
            wsDest.Range(wsDest.Cells(destRow, 1), wsDest.Cells(dataRow, "BA")).Borders.Weight = xlThin
            ' تطبيق التنسيق الخاص بالأعمدة المحددة
            Dim cols As Variant
            cols = Array("AT", "AU", "AV", "AW")
            Dim col As Variant
            For Each col In cols
                With wsDest.Range(col & destRow & ":" & col & dataRow)
                    .Interior.color = RGB(255, 242, 204)  ' لون ذهبي التمييز 4، 80% أفتح
                    .Borders.Weight = xlMedium            ' حدود سميكة متوسطة
                End With
            Next col
        Else
            MsgBox "لا توجد بيانات تطابق المعايير."
        End If
        .AutoFilterMode = False
        If .FilterMode Then
            .ShowAllData
        End If
    End With

    MsgBox "تم جلب البيانات بنجاح."
End Sub










Sub ClearData() 'كود المسح
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("الواجهة")
    Dim startRow As Integer
    startRow = 7 ' تعديل هذا الرقم ليتوافق مع الصف الذي تريد البدء منه في المسح
    ws.Rows(startRow & ":" & ws.Rows.Count).ClearContents
    MsgBox "تم مسح البيانات بنجاح!"
End Sub






Sub UpdateSelectedRowsAndFormat()   '  زر تحديدالصفوف
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("الواجهة")
    Dim selectedRange As Range
    Dim cell As Range
    Dim rowCount As Long

    ' مسح القيم السابقة في العمود AZ ومسح بيانات الخلية AU5
    ws.Range("AZ7:AZ" & ws.Cells(ws.Rows.Count, "AZ").End(xlUp).row).ClearContents
    ws.Range("AU5").ClearContents

    ' استخدام مربع الإدخال لتحديد النطاق
    Set selectedRange = Application.InputBox("اختر الصفوف للتعديل:", Type:=8)
    
    If Not selectedRange Is Nothing Then
        ' حساب عدد الصفوف المحددة
          For Each cell In selectedRange.Rows
            rowCount = rowCount + 1
        Next cell
        ' كتابة عدد الصفوف المحددة في الخلية AU5
        ws.Range("AU5").Value = "عدد الصفوف المحددة: " & rowCount
        With ws.Range("AU5")
            .Font.color = RGB(0, 0, 0)  ' اللون الأسود للنص
            .Font.Size = 10  ' حجم الخط للنص
            .Characters(Start:=Len("عدد الصفوف المحددة: ") + 1, Length:=Len(CStr(rowCount))).Font.color = RGB(255, 0, 0)  ' اللون الأحمر للعدد
            .Characters(Start:=Len("عدد الصفوف المحددة: ") + 1, Length:=Len(CStr(rowCount))).Font.Size = 12  ' حجم الخط للعدد
        End With

        ' تحديث العمود "AZ" لتعيين القيمة "تعديل" للصفوف المحددة
        For Each cell In selectedRange.Rows
            ws.Cells(cell.row, "AZ").Value = "تعديل"
            With ws.Cells(cell.row, "AZ")
                .Font.Name = "Calibri"
                .Font.Bold = True
                .Font.Size = 12
                .Font.color = RGB(255, 0, 0) ' اللون الأحمر
                .HorizontalAlignment = xlCenter ' توسيط النص في الخلية
            End With
        Next cell
        MsgBox "تم تحديد النطاق: " & selectedRange.Address
    Else
        MsgBox "لم يتم تحديد أي نطاق."
    End If
End Sub






Sub ClearSelectionValues() ' مسح القيم فقط في العمود AZ والخلية AU5
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("الواجهة")
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, "AZ").End(xlUp).row
    
    ' مسح القيم فقط في العمود AZ
    ws.Range("AZ7:AZ" & lastRow).ClearContents
    
    ' مسح محتويات الخلية AU5
    ws.Range("AU5").ClearContents
    
    MsgBox "تم مسح القيم في العمود 'AZ' والخلية 'AU5' بنجاح!"
End Sub











Sub FormatResultsBoth() 'كود احصاء الاعمدة في الخلايا "H5" و "AT5"
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("الواجهة")
    
    ' تحديث وتنسيق النتائج لعمود H
    Call UpdateAndFormat(ws, "H", "H5")
    
    ' تحديث وتنسيق النتائج لعمود AT
    Call UpdateAndFormat(ws, "AT", "AT5")
    
    MsgBox "تم تحديث وتنسيق البيانات بنجاح!"
End Sub

Sub UpdateAndFormat(ws As Worksheet, column As String, resultCell As String)
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, column).End(xlUp).row

    ' الحصول على البيانات من العمود
    Dim nonEmptyCount As Long
    nonEmptyCount = Application.WorksheetFunction.CountA(ws.Range(column & "7:" & column & lastRow))
    Dim dict As Object
    Set dict = CreateObject("Scripting.Dictionary")
    Dim cell As Range
    For Each cell In ws.Range(column & "7:" & column & lastRow)
        If Not IsEmpty(cell.Value) Then
            dict(cell.Value) = dict(cell.Value) + 1
        End If
    Next cell

    ' تنسيق النتيجة
    Dim resultText As String
    If column = "H" Then
        resultText = "العدد الكلي : " & nonEmptyCount & " , عدد الاقسام: " & dict.Count
    Else
        resultText = "العدد الكلي : " & nonEmptyCount & " , عدد المستلمين: " & dict.Count
    End If
    ws.Range(resultCell).Value = resultText

    ' تطبيق تنسيقات النص
    With ws.Range(resultCell)
        .Font.Name = "Calibri"
        .Font.color = RGB(0, 0, 0) ' اللون الأسود لكامل النص
        .Font.Size = 10 ' حجم الخط لكامل النص
        Dim startPos As Long
        startPos = InStr(resultText, ":") + 2
        .Characters(Start:=startPos, Length:=Len(nonEmptyCount)).Font.Bold = True
        .Characters(Start:=startPos, Length:=Len(nonEmptyCount)).Font.color = RGB(255, 0, 0) ' الرقم باللون الأحمر
        .Characters(Start:=startPos, Length:=Len(nonEmptyCount)).Font.Size = 12 ' حجم الخط للرقم باللون الغامق
        startPos = InStrRev(resultText, ":") + 2
        .Characters(Start:=startPos, Length:=Len(dict.Count)).Font.Bold = True
        .Characters(Start:=startPos, Length:=Len(dict.Count)).Font.Size = 12 ' حجم الخط للرقم باللون الغامق
        .Characters(Start:=startPos, Length:=Len(dict.Count)).Font.color = RGB(255, 0, 0) ' الرقم باللون الأحمر
    End With
End Sub



Sub EditSelectedRows() ' التعديل Edit
    Dim ws As Worksheet
    Dim wsSource As Worksheet
    Set ws = ThisWorkbook.Sheets("الواجهة")
    Set wsSource = ThisWorkbook.Sheets("ALL FA- الاصول")
    Dim lastRow As Long
    Dim i As Long
    Dim assetTag As String

    ' الحصول على القيم الجديدة من الخلايا "AT3"، "AU3"، "AV3"، و"AW3"
    Dim newValue1 As String
    Dim newValue2 As String
    Dim newValue3 As String
    Dim newValue4 As String
    
    newValue1 = ws.Range("AT3").Value
    newValue2 = ws.Range("AU3").Value
    newValue3 = ws.Range("AV3").Value
    newValue4 = ws.Range("AW3").Value

    ' التحقق من وجود القيم الجديدة
    If IsEmpty(newValue1) Or IsEmpty(newValue2) Or IsEmpty(newValue3) Or IsEmpty(newValue4) Then
        MsgBox "تأكد من إدخال القيم الجديدة في الخلايا AT3، AU3، AV3، و AW3.", vbExclamation
        Exit Sub
    End If

    ' تحديد آخر صف يحتوي على بيانات في العمود "AZ" في ورقة "الواجهة"
    lastRow = ws.Cells(ws.Rows.Count, "AZ").End(xlUp).row

    ' التكرار عبر الصفوف من الصف 7 إلى آخر صف وتعديل البيانات في ورقة "الواجهة"
    On Error Resume Next
    For i = 7 To lastRow
        If ws.Cells(i, "AZ").Value = "تعديل" Then
            ' تعديل البيانات في الصف الحالي في ورقة "الواجهة"
            ws.Cells(i, "AT").Value = newValue1
            ws.Cells(i, "AU").Value = newValue2
            ws.Cells(i, "AV").Value = newValue3
            ws.Cells(i, "AW").Value = newValue4

            ' الحصول على قيمة "Asset Tag" لتحديد الصف المقابل في ورقة "ALL FA- الاصول"
            assetTag = ws.Cells(i, "A").Value

            ' تعديل البيانات في الصف المقابل في ورقة "ALL FA- الاصول"
            Dim sourceRow As Long
            sourceRow = wsSource.Columns("A").Find(What:=assetTag, LookIn:=xlValues, LookAt:=xlWhole).row
            
            If sourceRow > 0 Then
                wsSource.Cells(sourceRow, "AT").Value = newValue1
                wsSource.Cells(sourceRow, "AU").Value = newValue2
                wsSource.Cells(sourceRow, "AV").Value = newValue3
                wsSource.Cells(sourceRow, "AW").Value = newValue4
            Else
                MsgBox "لم يتم العثور على Asset Tag: " & assetTag & " في صفحة ALL FA- الاصول.", vbExclamation
            End If
        End If
    Next i
    On Error GoTo 0

    MsgBox "تم تعديل البيانات بنجاح في كلا الصفحتين."
End Sub



