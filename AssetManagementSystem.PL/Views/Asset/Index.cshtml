@model IEnumerable<AssetManagementSystem.DAL.Entities.Asset>

@{
    ViewData["Title"] = "إدارة الأصول";
    Layout = "~/Views/Shared/_Dashboard_Tabler.cshtml";
}

<!-- Professional Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay d-none">
    <div class="loading-content">
        <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
        <h5 class="text-primary">جاري تحميل البيانات...</h5>
        <p class="text-muted mb-0">يرجى الانتظار</p>
    </div>
</div>

<!-- Notification Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer">
    <!-- Toasts will be added here dynamically -->
</div>

<!-- Main Page Header -->
<div class="page-header bg-white border-bottom py-3 mb-4">
    <div class="container-fluid">
        <div class="row align-items-center">
            <!-- Page Title Section -->
            <div class="col-md-4">
                <div class="page-title-section">
                    <nav aria-label="breadcrumb" class="mb-2">
                        <ol class="breadcrumb breadcrumb-sm mb-0">
                            <li class="breadcrumb-item">
                                <a href="@Url.Action("Index", "Home")" class="text-decoration-none">
                                    <i class="fas fa-home"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">إدارة الأصول</li>
                        </ol>
                    </nav>
                    <h1 class="page-title h4 mb-1 fw-bold text-dark">
                        <i class="fas fa-cube text-primary me-2"></i>
                        إدارة الأصول
                    </h1>
                    <p class="page-subtitle text-muted small mb-0">نظام شامل لإدارة ومتابعة الأصول</p>
                </div>
            </div>
            
            <!-- Quick Actions Section -->
            <div class="col-md-4">
                <div class="quick-actions d-flex justify-content-center gap-2">
                    <button type="button" 
                            id="refreshDataBtn" 
                            class="btn btn-outline-primary btn-sm"
                            title="تحديث البيانات"
                            data-bs-toggle="tooltip">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    
                    <button type="button" 
                            class="btn btn-outline-info btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#filterModal"
                            title="فلترة متقدمة"
                            data-bs-toggle="tooltip">
                        <i class="fas fa-filter"></i>
                    </button>
                    
                    <div class="dropdown">
                        <button class="btn btn-outline-success btn-sm dropdown-toggle" 
                                type="button" 
                                data-bs-toggle="dropdown"
                                title="تصدير البيانات"
                                data-bs-toggle="tooltip">
                            <i class="fas fa-download"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" href="@Url.Action("ExportAssets", "Asset")">
                                    <i class="fas fa-file-excel text-success me-2"></i>
                                    تصدير Excel
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action("ExportAssetsToPdf", "Asset")">
                                    <i class="fas fa-file-pdf text-danger me-2"></i>
                                    تصدير PDF
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <button type="button" 
                            class="btn btn-outline-secondary btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#settingsModal"
                            title="إعدادات العرض"
                            data-bs-toggle="tooltip">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            
            <!-- Primary Actions Section -->
            <div class="col-md-4">
                <div class="primary-actions d-flex justify-content-end gap-2">
                    <div class="search-input-wrapper">
                        <div class="input-group input-group-sm">
                            <span class="input-group-text bg-light border-end-0">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                            <input type="text" 
                                   id="globalSearch" 
                                   class="form-control border-start-0 bg-light" 
                                   placeholder="البحث في الأصول..."
                                   style="max-width: 200px;">
                        </div>
                    </div>
                    
                    <a asp-action="Create" 
                       class="btn btn-primary btn-sm px-3">
                        <i class="fas fa-plus me-1"></i>
                        إضافة أصل
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="status-bar d-flex align-items-center justify-content-between py-2 px-3 bg-light rounded">
                    <div class="status-info d-flex align-items-center gap-3">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            آخر تحديث: <span id="lastUpdateTime" class="fw-medium">--</span>
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-database me-1"></i>
                            إجمالي الأصول: <span id="totalAssetsCount" class="fw-medium text-primary">0</span>
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-eye me-1"></i>
                            معروض: <span id="displayedCount" class="fw-medium">0</span>
                        </small>
                    </div>
                    
                    <div class="connection-status">
                        <small class="text-success">
                            <i class="fas fa-circle me-1" style="font-size: 8px;"></i>
                            متصل
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- Asset Overview Statistics -->
<div class="container-fluid mb-4">
    <div class="row g-3">
        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="card stat-card h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-primary bg-gradient rounded-3 p-3 me-3">
                        <i class="fas fa-boxes text-white fa-lg"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number mb-0" id="totalAssets">0</h3>
                        <p class="text-muted mb-0 small">إجمالي الأصول</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="card stat-card h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-success bg-gradient rounded-3 p-3 me-3">
                        <i class="fas fa-check-circle text-white fa-lg"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number mb-0" id="activeAssets">0</h3>
                        <p class="text-muted mb-0 small">الأصول النشطة</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="card stat-card h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-warning bg-gradient rounded-3 p-3 me-3">
                        <i class="fas fa-tools text-white fa-lg"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number mb-0" id="maintenanceAssets">0</h3>
                        <p class="text-muted mb-0 small">قيد الصيانة</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="card stat-card h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="stat-icon bg-danger bg-gradient rounded-3 p-3 me-3">
                        <i class="fas fa-trash-alt text-white fa-lg"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number mb-0" id="disposedAssets">0</h3>
                        <p class="text-muted mb-0 small">تم التكهين</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions Bar -->
<div class="container-fluid mb-4">
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h6 class="card-title mb-3">
                        <i class="fas fa-bolt text-primary me-2"></i>
                        العمليات السريعة
                    </h6>
                    
                    <!-- Bulk Operations -->
                    <div class="bulk-operations d-flex flex-wrap gap-2">
                        <button id="bulkTransferBtn" 
                                class="btn btn-outline-primary position-relative" 
                                disabled>
                            <i class="fas fa-exchange-alt me-1"></i>
                            نقل مجمع
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary" 
                                  id="transferBadge" 
                                  style="display: none;">
                                0
                            </span>
                        </button>
                        
                        <button id="bulkDisposeBtn" 
                                class="btn btn-outline-warning position-relative" 
                                disabled>
                            <i class="fas fa-trash-alt me-1"></i>
                            تكهين مجمع
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning" 
                                  id="disposeBadge" 
                                  style="display: none;">
                                0
                            </span>
                        </button>
                        
                        <button id="bulkSupervisorBtn" 
                                class="btn btn-outline-info position-relative" 
                                disabled>
                            <i class="fas fa-user-check me-1"></i>
                            تعيين مشرف
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-info" 
                                  id="supervisorBadge" 
                                  style="display: none;">
                                0
                            </span>
                        </button>
                        
                        <button id="bulkReturnBtn" 
                                class="btn btn-outline-success position-relative" 
                                disabled>
                            <i class="fas fa-undo-alt me-1"></i>
                            مستند إرجاع
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success" 
                                  id="returnBadge" 
                                  style="display: none;">
                                0
                            </span>
                        </button>
                        
                        <button id="clearSelectionBtn" 
                                class="btn btn-outline-secondary" 
                                disabled>
                            <i class="fas fa-eraser me-1"></i>
                            مسح التحديد
                        </button>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="selection-summary text-center">
                        <div class="card bg-light border-0">
                            <div class="card-body py-2">
                                <h6 class="mb-1">العناصر المحددة</h6>
                                <h4 class="text-primary mb-0" id="selectedCount">0</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Search Panel (Collapsible) -->
<div class="container-fluid mb-4">
    <div class="collapse" id="advancedSearchPanel">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="fas fa-search-plus me-2"></i>
                    البحث المتقدم
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Asset Tag</label>
                        <textarea id="assetTagsInput" 
                                  class="form-control" 
                                  rows="3" 
                                  placeholder="AST001&#10;AST002&#10;AST003"></textarea>
                        <small class="text-muted">أدخل كل tag في سطر منفصل</small>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">القسم</label>
                        <select id="departmentFilter" class="form-select">
                            <option value="">جميع الأقسام</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">الحالة</label>
                        <select id="statusFilter" class="form-select">
                            <option value="">جميع الحالات</option>
                            <option value="Active">نشط</option>
                            <option value="Maintenance">صيانة</option>
                            <option value="Disposed">مكهن</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">المنشأة</label>
                        <select id="facilityFilter" class="form-select">
                            <option value="">جميع المنشآت</option>
                        </select>
                    </div>
                </div>
                
                <div class="row g-3 mt-2">
                    <div class="col-md-3">
                        <label class="form-label">الماركة</label>
                        <input type="text" id="brandFilter" class="form-control" placeholder="مثال: Dell, HP">
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">الموديل</label>
                        <input type="text" id="modelFilter" class="form-control" placeholder="الموديل">
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">من تاريخ</label>
                        <input type="date" id="dateFromFilter" class="form-control">
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label">إلى تاريخ</label>
                        <input type="date" id="dateToFilter" class="form-control">
                    </div>
                </div>
                
                <div class="mt-3 d-flex gap-2">
                    <button type="button" id="applyFiltersBtn" class="btn btn-primary">
                        <i class="fas fa-search me-1"></i>
                        تطبيق المرشحات
                    </button>
                    <button type="button" id="clearFiltersBtn" class="btn btn-outline-secondary">
                        <i class="fas fa-eraser me-1"></i>
                        مسح المرشحات
                    </button>
                    <button type="button" id="saveFiltersBtn" class="btn btn-outline-info">
                        <i class="fas fa-save me-1"></i>
                        حفظ كنموذج
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Main Assets Table -->
<div class="container-fluid">
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-table me-2 text-primary"></i>
                        قائمة الأصول
                        <span class="badge bg-primary rounded-pill ms-2" id="tableCountBadge">0</span>
                    </h5>
                    <small class="text-muted">إدارة وعرض جميع الأصول المسجلة</small>
                </div>
                
                <div class="col-md-6">
                    <div class="table-controls d-flex justify-content-end gap-2">
                        <!-- View Toggle -->
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="viewMode" id="tableView" checked>
                            <label class="btn btn-outline-primary btn-sm" for="tableView" title="عرض الجدول">
                                <i class="fas fa-table"></i>
                            </label>
                            <input type="radio" class="btn-check" name="viewMode" id="cardView">
                            <label class="btn btn-outline-primary btn-sm" for="cardView" title="عرض البطاقات">
                                <i class="fas fa-th-large"></i>
                            </label>
                        </div>
                        
                        <!-- Table Options -->
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" 
                                    type="button" 
                                    data-bs-toggle="dropdown">
                                <i class="fas fa-cog"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <a class="dropdown-item" id="exportVisibleColumns">
                                        <i class="fas fa-eye me-2"></i>تصدير الأعمدة المرئية
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" id="resetTableState">
                                        <i class="fas fa-undo me-2"></i>إعادة تعيين الجدول
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" id="toggleCompactMode">
                                        <i class="fas fa-compress me-2"></i>الوضع المضغوط
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Column Visibility -->
                        <div class="dropdown">
                            <button class="btn btn-outline-info btn-sm dropdown-toggle" 
                                    type="button" 
                                    data-bs-toggle="dropdown">
                                <i class="fas fa-columns me-1"></i>الأعمدة
                            </button>
                            <div class="dropdown-menu dropdown-menu-end p-3" style="min-width: 250px;">
                                <h6 class="dropdown-header">إدارة الأعمدة</h6>
                                <div id="columnToggles">
                                    <!-- Will be populated by JavaScript -->
                                </div>
                                <div class="dropdown-divider"></div>
                                <button class="btn btn-sm btn-outline-primary w-100" id="showAllColumns">
                                    <i class="fas fa-eye me-1"></i>إظهار الكل
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Table Statistics -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="table-stats d-flex flex-wrap gap-3 small text-muted">
                        <span>
                            <i class="fas fa-list me-1"></i>
                            إجمالي: <strong id="totalRows">0</strong>
                        </span>
                        <span>
                            <i class="fas fa-check-square me-1"></i>
                            محدد: <strong id="selectedRows">0</strong>
                        </span>
                        <span>
                            <i class="fas fa-filter me-1"></i>
                            مصفى: <strong id="filteredRows">0</strong>
                        </span>
                        <span>
                            <i class="fas fa-clock me-1"></i>
                            آخر تحديث: <strong id="lastRefresh">--</strong>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card-body p-0">
            <!-- Table View -->
            <div id="tableViewContainer" class="table-responsive">
                <table id="assetsTable" class="table table-hover align-middle mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th width="40px" class="text-center">
                                <div class="form-check">
                                    <input type="checkbox" id="selectAll" class="form-check-input">
                                </div>
                            </th>
                            <th width="120px" class="text-center">العمليات</th>
                            <th class="sortable" data-column="AssetTag">
                                Asset Tag
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Description">
                                الوصف
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Department">
                                القسم
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Facility">
                                المنشأة
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Building">
                                المبنى
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Floor">
                                الطابق
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Room">
                                الغرفة
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Brand">
                                الماركة
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Model">
                                الموديل
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Type">
                                النوع
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-column="Status">
                                الحالة
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
            
            <!-- Card View -->
            <div id="cardViewContainer" class="d-none">
                <div class="row g-3 p-3" id="assetsGrid">
                    <!-- Cards will be generated dynamically -->
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-5 d-none">
                <div class="empty-icon mb-3">
                    <i class="fas fa-inbox fa-4x text-muted"></i>
                </div>
                <h5 class="text-muted">لا توجد أصول</h5>
                <p class="text-muted">لم يتم العثور على أصول تطابق المعايير المحددة</p>
                <button class="btn btn-outline-primary" id="clearAllFilters">
                    <i class="fas fa-filter me-2"></i>مسح جميع المرشحات
                </button>
            </div>
            
            <!-- Loading State -->
            <div id="tableLoadingState" class="text-center py-5 d-none">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">جاري التحميل...</span>
                </div>
                <h6 class="text-muted">جاري تحميل البيانات...</h6>
            </div>
        </div>
        
        <!-- Table Footer -->
        <div class="card-footer bg-light">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="table-info">
                        <span class="text-muted">
                            عرض <strong id="showingFrom">0</strong> إلى <strong id="showingTo">0</strong>
                            من أصل <strong id="totalEntries">0</strong> صف
                            <span id="filteredInfo" class="text-primary d-none">
                                (مصفى من <strong id="totalBeforeFilter">0</strong> صف)
                            </span>
                        </span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-end align-items-center gap-3">
                        <div class="page-size-selector d-flex align-items-center">
                            <label class="form-label me-2 mb-0 small">عرض:</label>
                            <select class="form-select form-select-sm" id="pageSizeSelector" style="width: auto;">
                                <option value="10">10</option>
                                <option value="25" selected>25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="-1">الكل</option>
                            </select>
                        </div>
                        <nav id="tablePagination">
                            <!-- Pagination will be generated dynamically -->
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-file-import me-2"></i> استيراد أصول</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <div class="import-icon-container mb-3">
                        <i class="fas fa-file-excel fa-4x text-success"></i>
                        <i class="fas fa-arrow-right fa-2x text-primary mx-3"></i>
                        <i class="fas fa-database fa-4x text-primary"></i>
                    </div>
                    <h5>استيراد أصول من ملف Excel</h5>
                    <p class="text-muted">قم بتحميل ملف Excel يحتوي على بيانات الأصول</p>
                </div>

                @using (Html.BeginForm("ImportAssets", "Asset", FormMethod.Post, new { enctype = "multipart/form-data", id = "importForm" }))
                {
                    <div class="mb-3">
                        <div class="custom-file-upload">
                            <div class="input-group">
                                <input type="file" name="file" id="importFile" class="form-control" accept=".xlsx,.xls" required />
                                <label for="importFile" class="input-group-text">
                                    <i class="fas fa-upload"></i>
                                </label>
                            </div>
                            <small class="form-text text-muted">الملفات المدعومة: .xlsx, .xls</small>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <span>تأكد من أن الملف يحتوي على الأعمدة الصحيحة المطابقة لنموذج النظام</span>
                    </div>
                    <a href="#" id="downloadTemplate" class="btn btn-outline-primary btn-sm mb-3">
                        <i class="fas fa-download me-1"></i> تنزيل نموذج للاستيراد
                    </a>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i> إلغاء
                </button>
                <button type="submit" form="importForm" class="btn btn-primary">
                    <i class="fas fa-file-import me-1"></i> استيراد
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Transfer Modal -->
<div class="modal fade" id="bulkTransferModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exchange-alt me-2"></i> نقل الأصول المجمعة
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="bulkTransferForm">
                <div class="modal-body">


                    <div class="mb-4">
                        <label class="form-label fw-bold">القسم الهدف</label>
                        <select id="targetDepartment" class="form-select form-select-lg mb-3" required>
                            <option value="">-- اختر القسم --</option>
                        </select>
                        <div class="invalid-feedback">يرجى اختيار القسم الهدف</div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold">المستلم الهدف (جميع المستخدمين)</label>
                        <select id="targetUser" class="form-select form-select-lg">
                            <option value="">-- غير محدد --</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold">المستلم الهدف (مستخدمي القسم المحدد)</label>
                        <select id="targetDepartmentUser" class="form-select form-select-lg">
                            <option value="">-- غير محدد --</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> إلغاء
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check me-1"></i> تأكيد النقل
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bulk Disposal Modal -->
<div class="modal fade" id="bulkDisposalModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title">
                    <i class="fas fa-trash-alt me-2"></i> التكهين من الأصول المجمعة
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="bulkDisposalForm">
                <div class="modal-body">


                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">نوع التكهين</label>
                            <input type="text" id="disposalType" class="form-control" required placeholder="  ادخل النوع  ">
                            <div class="invalid-feedback">يرجى ادخال نوع التكهين</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">قيمة البيع (ريال)</label>
                            <div class="input-group">
                                <span class="input-group-text">ر.س</span>
                                <input type="number" id="saleValue" class="form-control" value="0" min="0" step="0.01" />
                            </div>
                            <small class="form-text text-muted">أدخل 0 إذا لم يكن هناك قيمة بيع</small>
                        </div>
                    </div>




                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="generateDocument" checked>
                        <label class="form-check-label" for="generateDocument">إنشاء وتنزيل مستند التكهين تلقائياً</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> إلغاء
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-trash-alt me-1"></i> تأكيد التكهين
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bulk Supervisor Assignment Modal -->
<div class="modal fade" id="bulkSupervisorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-people"></i> تعيين مشرف
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="bulkSupervisorForm">
                <div class="modal-body">
                    <div class="alert alert-info">
                        تم اختيار <span id="supervisorAssetCount">0</span> أصل لتعيين المشرف
                    </div>
                    <div class="mb-3">
                        <label class="form-label">اختر المشرف</label>
                        <select id="supervisorSelect" class="form-select" required>
                            <option value="">-- اختر المشرف --</option>
                            <!-- سيتم ملؤها بواسطة جافا سكريبت -->
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x"></i> إلغاء
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check2"></i> تعيين
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Professional Asset Details Modal -->
<div class="modal fade" id="assetDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-info-circle me-2"></i>تفاصيل الأصل
                    <span id="assetTagTitle" class="badge bg-light text-primary ms-2"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="asset-details-container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="detail-tabs">
                                <ul class="nav nav-pills mb-3" id="assetDetailTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="basic-info-tab" data-bs-toggle="pill"
                                                data-bs-target="#basic-info" type="button" role="tab">
                                            <i class="fas fa-info me-2"></i>المعلومات الأساسية
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="location-tab" data-bs-toggle="pill"
                                                data-bs-target="#location" type="button" role="tab">
                                            <i class="fas fa-map-marker-alt me-2"></i>الموقع
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="history-tab" data-bs-toggle="pill"
                                                data-bs-target="#history" type="button" role="tab">
                                            <i class="fas fa-history me-2"></i>السجل
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="documents-tab" data-bs-toggle="pill"
                                                data-bs-target="#documents" type="button" role="tab">
                                            <i class="fas fa-file-alt me-2"></i>المستندات
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="assetDetailTabsContent">
                                    <div class="tab-pane fade show active" id="basic-info" role="tabpanel">
                                        <div id="basicInfoContent">
                                            <!-- سيتم ملؤها ديناميكياً -->
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="location" role="tabpanel">
                                        <div id="locationContent">
                                            <!-- سيتم ملؤها ديناميكياً -->
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="history" role="tabpanel">
                                        <div id="historyContent">
                                            <!-- سيتم ملؤها ديناميكياً -->
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="documents" role="tabpanel">
                                        <div id="documentsContent">
                                            <!-- سيتم ملؤها ديناميكياً -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="asset-actions-panel">
                                <h6 class="panel-title">
                                    <i class="fas fa-tools me-2"></i>العمليات المتاحة
                                </h6>
                                <div class="action-buttons">
                                    <a class="btn btn-outline-primary btn-sm w-100 mb-2" id="editAssetBtn">
                                        <i class="fas fa-edit me-2"></i>تعديل
                                    </a>
                                    <button class="btn btn-outline-info btn-sm w-100 mb-2" id="transferAssetBtn">
                                        <i class="fas fa-exchange-alt me-2"></i>نقل
                                    </button>
                                    <button class="btn btn-outline-warning btn-sm w-100 mb-2" id="maintenanceAssetBtn">
                                        <i class="fas fa-tools me-2"></i>صيانة
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm w-100 mb-2" id="disposeAssetBtn">
                                        <i class="fas fa-trash-alt me-2"></i>تكهين
                                    </button>
                                    <hr>
                                    <button class="btn btn-outline-success btn-sm w-100 mb-2" id="printAssetLabel">
                                        <i class="fas fa-print me-2"></i>طباعة باركود
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm w-100" id="exportAssetDetails">
                                        <i class="fas fa-file-export me-2"></i>تصدير التفاصيل
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Export Options Modal -->
<div class="modal fade" id="advancedExportModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-file-export me-2"></i>خيارات التصدير المتقدمة
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="export-options-container">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-file-alt me-2"></i>نوع الملف</h6>
                            <div class="export-format-options">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="exportFormat" id="formatExcel" value="excel" checked>
                                    <label class="form-check-label" for="formatExcel">
                                        <i class="fas fa-file-excel text-success me-2"></i>Excel (.xlsx)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="exportFormat" id="formatCSV" value="csv">
                                    <label class="form-check-label" for="formatCSV">
                                        <i class="fas fa-file-csv text-info me-2"></i>CSV (.csv)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="exportFormat" id="formatPDF" value="pdf">
                                    <label class="form-check-label" for="formatPDF">
                                        <i class="fas fa-file-pdf text-danger me-2"></i>PDF (.pdf)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="exportFormat" id="formatJSON" value="json">
                                    <label class="form-check-label" for="formatJSON">
                                        <i class="fas fa-code text-warning me-2"></i>JSON (.json)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-columns me-2"></i>الأعمدة المطلوبة</h6>
                            <div class="column-selection">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="selectAllColumns" checked>
                                    <label class="form-check-label fw-bold" for="selectAllColumns">
                                        تحديد الكل
                                    </label>
                                </div>
                                <hr>
                                <div id="columnCheckboxes">
                                    <!-- سيتم إنشاؤها ديناميكياً -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-filter me-2"></i>خيارات التصفية</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="exportSelectedOnly">
                                <label class="form-check-label" for="exportSelectedOnly">
                                    تصدير الصفوف المحددة فقط
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="exportVisibleOnly">
                                <label class="form-check-label" for="exportVisibleOnly">
                                    تصدير الصفوف المرئية فقط
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeHeaders" checked>
                                <label class="form-check-label" for="includeHeaders">
                                    تضمين رؤوس الأعمدة
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-cog me-2"></i>إعدادات إضافية</h6>
                            <div class="mb-3">
                                <label class="form-label">اسم الملف</label>
                                <input type="text" class="form-control" id="exportFileName"
                                       placeholder="أصول_المؤسسة">
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="includeTimestamp" checked>
                                <label class="form-check-label" for="includeTimestamp">
                                    إضافة التاريخ والوقت للاسم
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="openAfterExport">
                                <label class="form-check-label" for="openAfterExport">
                                    فتح الملف بعد التصدير
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>إلغاء
                </button>
                <button type="button" class="btn btn-success" id="startAdvancedExport">
                    <i class="fas fa-download me-2"></i>بدء التصدير
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Professional Settings Panel -->
<div class="modal fade" id="settingsModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient-dark text-white">
                <h5 class="modal-title">
                    <i class="fas fa-cogs me-2"></i>إعدادات النظام
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="settings-container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="nav flex-column nav-pills" id="settingsNav" role="tablist">
                                <button class="nav-link active" id="appearance-tab" data-bs-toggle="pill"
                                        data-bs-target="#appearance" type="button" role="tab">
                                    <i class="fas fa-palette me-2"></i>المظهر
                                </button>
                                <button class="nav-link" id="performance-tab" data-bs-toggle="pill"
                                        data-bs-target="#performance" type="button" role="tab">
                                    <i class="fas fa-tachometer-alt me-2"></i>الأداء
                                </button>
                                <button class="nav-link" id="notifications-tab" data-bs-toggle="pill"
                                        data-bs-target="#notifications" type="button" role="tab">
                                    <i class="fas fa-bell me-2"></i>الإشعارات
                                </button>
                                <button class="nav-link" id="data-tab" data-bs-toggle="pill"
                                        data-bs-target="#data" type="button" role="tab">
                                    <i class="fas fa-database me-2"></i>البيانات
                                </button>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="tab-content" id="settingsTabContent">
                                <div class="tab-pane fade show active" id="appearance" role="tabpanel">
                                    <h6>إعدادات المظهر</h6>
                                    <div class="setting-group">
                                        <label class="form-label">سمة اللون</label>
                                        <select class="form-select" id="themeSelector">
                                            <option value="default">الافتراضي</option>
                                            <option value="dark">داكن</option>
                                            <option value="light">فاتح</option>
                                            <option value="blue">أزرق</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="compactMode">
                                            <label class="form-check-label" for="compactMode">
                                                الوضع المضغوط
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="showAnimations" checked>
                                            <label class="form-check-label" for="showAnimations">
                                                إظهار الرسوم المتحركة
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="performance" role="tabpanel">
                                    <h6>إعدادات الأداء</h6>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoRefresh">
                                            <label class="form-check-label" for="autoRefresh">
                                                التحديث التلقائي
                                            </label>
                                        </div>
                                        <small class="form-text text-muted">تحديث البيانات كل 30 ثانية</small>
                                    </div>
                                    <div class="setting-group">
                                        <label class="form-label">عدد الصفوف لكل صفحة</label>
                                        <select class="form-select" id="defaultPageSize">
                                            <option value="10">10</option>
                                            <option value="25" selected>25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </div>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="enableCache" checked>
                                            <label class="form-check-label" for="enableCache">
                                                تفعيل الذاكرة المؤقتة
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="notifications" role="tabpanel">
                                    <h6>إعدادات الإشعارات</h6>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="enableNotifications" checked>
                                            <label class="form-check-label" for="enableNotifications">
                                                تفعيل الإشعارات
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="soundEnabled">
                                            <label class="form-check-label" for="soundEnabled">
                                                تفعيل الأصوات
                                            </label>
                                        </div>
                                    </div>
                                    <div class="setting-group">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="showToasts" checked>
                                            <label class="form-check-label" for="showToasts">
                                                إظهار النوافذ المنبثقة
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="data" role="tabpanel">
                                    <h6>إعدادات البيانات</h6>
                                    <div class="setting-group">
                                        <button class="btn btn-outline-danger" id="clearLocalData">
                                            <i class="fas fa-trash me-2"></i>مسح البيانات المحلية
                                        </button>
                                        <small class="form-text text-muted">مسح جميع البيانات المحفوظة محلياً</small>
                                    </div>
                                    <div class="setting-group">
                                        <button class="btn btn-outline-info" id="exportSettings">
                                            <i class="fas fa-download me-2"></i>تصدير الإعدادات
                                        </button>
                                        <small class="form-text text-muted">تصدير إعداداتك الحالية</small>
                                    </div>
                                    <div class="setting-group">
                                        <button class="btn btn-outline-warning" id="resetSettings">
                                            <i class="fas fa-undo me-2"></i>إعادة تعيين الإعدادات
                                        </button>
                                        <small class="form-text text-muted">إعادة جميع الإعدادات للحالة الافتراضية</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>إغلاق
                </button>
                <button type="button" class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save me-2"></i>حفظ الإعدادات
                </button>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/asset-index-enhanced.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.4/css/select.bootstrap5.min.css">
}

@section Scripts {
    <!-- Core Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- DataTables Core -->
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>

    <!-- DataTables Extensions -->
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>

    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

    <!-- Custom Scripts -->
    <script src="~/js/asset-index.js"></script>

    <script>
        // Check if jQuery is loaded
        if (typeof jQuery === 'undefined') {
            console.error('jQuery is not loaded!');
            alert('Error: jQuery is not loaded. Please check your internet connection and try again.');
        }

        // Check if DataTables is loaded
        if (typeof $.fn.DataTable === 'undefined') {
            console.error('DataTables is not loaded!');
            alert('Error: DataTables is not loaded. Please check your internet connection and try again.');
        }

        // Check if SweetAlert2 is loaded
        if (typeof Swal === 'undefined') {
            console.error('SweetAlert2 is not loaded!');
            alert('Error: SweetAlert2 is not loaded. Please check your internet connection and try again.');
        }

        // Add error handling for script loading
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT') {
                console.error('Script loading error:', e);
                alert('Error loading required scripts. Please check your internet connection and try again.');
            }
        }, true);
    </script>
}